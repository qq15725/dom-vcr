<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Playground</title>
  <style>
    @keyframes color
    {
      from {
        background: red;
      }

      to {
        background: yellow;
      }
    }

    #app {
      width: 200px;
      height: 200px;
      border-radius: 50%;
      animation: color 1s infinite;
    }
  </style>
</head>
<body>
  <div id="app"></div>

  <button style="margin-top: 14px;">Generate MP4</button>

  <script type="module">
    import { createDomVcr } from './src'

    function blobToDataURL(blob) {
      return new Promise(resolve => {
        const reader = new FileReader()
        reader.onload = e => resolve(e.target.result)
        reader.readAsDataURL(blob)
      })
    }

    document.querySelector('button').addEventListener('click', e => {
      if (e.target.innerText === 'Generating') return

      const vcr = createDomVcr(document.querySelector('#app'))

      vcr.start()

      e.target.disabled = 'disabled'
      e.target.innerText = 'Generating'

      setTimeout(async () => {
        const blob = await vcr.stop()
        const link = document.createElement('a')
        link.download = 'example.mp4'
        link.href = await blobToDataURL(blob)
        link.click()
        e.target.disabled = undefined
        e.target.innerText = 'Generate MP4'
      }, 5000)

      // const vcr = createDomVcr(document.querySelector('#app'), { autoAddFrame: false, fps: 1 })
      //
      // vcr.start()
      //   .then(() => vcr.addFrame())
      //   .then(() => vcr.addFrame())
      //   .then(() => vcr.addFrame())
      //   .then(() => vcr.stop())
      //   .then(blob => {
      //     window.open(URL.createObjectURL(blob))
      //   })
    })
  </script>
</body>
</html>
